<!DOCTYPE html>
  <meta charset="utf-8" />
  <title>WebSocket Test</title>
  <script language="javascript" type="text/javascript">
  var wsUri = "wss://price-api.vndirect.com.vn/realtime";
  var output;
  var websocket;
  function init()
  {
    output = document.getElementById("output");
    testWebSocket();
  }
  function testWebSocket()
  {
    websocket = new WebSocket(wsUri);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }
  function onOpen(evt) {
    writeToScreen("CONNECTED");
    doSend("a");
  }
  function onClose(evt)
  {
    writeToScreen("DISCONNECTED");
  }
  function onMessage(evt) {
    writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
    const p = evt.data.indexOf("|")
    const action = evt.data.substring(0, p)
    const data = evt.data.slice(p + 1)
    console.log(action)
    if (action === "c") {
      const [server, process, connectionId] = data.split("_")
      websocket.server = server;
      websocket.process = process;
      websocket.connectionId = connectionId;
      doSend("ss|S:code=AAV,ACB,ACM,ADC,AGC,ALT,ALV,AMC,AME,AMV,APG,API,APP,APS,ARM,ART,ASA,ATS,B82,BAX,BBS,BCC,BDB,BED,BHT,BII,BKC,BLF,BPC,BSC,BST,BTS,BTW,BVS,BXH,C69,C92,CAG,CAN,CAP,CCM,CDN,CEO,CET,CIA,CJC,CKV,CLH,CLM,CMC,CMI,CMS,CPC,CSC,CT6,CTA,CTB,CTC,CTN,CTP,CTT,CTX,CVN,CX8,D11,DAC,DAD,DAE,DBC,DBT,DC2,DC4,DCS,DDG,DGC,DGL,DHP,DHT,DID,DIH,DL1,DLR,DNC,DNM,DNP,DNY,DP3,DPC,DPS,DS3,DST,DTD,DXP,DZM,E1SSHN30,EBS,ECI,EFI,EID,FDT,FID,GDW,GKM,GLT,GMX,HAD,HAT,HBB,HBE,HBS,HCC,HCT,HDA,HDO,HEV,HGM,HHC,HHG,HHP,HJS,HKB,HKT,HLC,HLD,HLY,HMH,HNM,HOM,HPC,HPM,HPS,HST,HTC,HTP,HUT,HVA,HVT,ICG,IDJ,IDV,INC,INN,ITQ,IVS,KDM,KHB,KHL,KHS,KKC,KLF,KLS,KMT,KSD,KSK,KSQ,KST,KTS,KTT,KVC,L14,L18,L35,L43,L44,L61,L62,LAS,LBE,LCD,LCS,LDP,LHC,LIG,LM7,LO5,LTC,LUT,MAC,MAS,MBG,MBS,MCC,MCF,MCO,MDC,MEC,MEL,MHL,MIM,MKV,MLS,MNC,MPT,MSC,MST,NAG,NAP,NBC,NBP,NBW,NDF,NDN,NDX,NET,NFC,NGC,NHA,NHC,NHP,NPS,NRC,NSH,NST,NTP,NVB,OCH,ONE,ORS,PBP,PCE,PCG,PCN,PCT,PDB,PDC,PEN,PGS,PGT,PHC,PHN,PHP,PIC,PIV,PJC,PLC,PMB,PMC,PMP,PMS,POT,PPE,PPP,PPS,PPY,PRC,PSC,PSD,PSE,PSI,PSW,PTD,PTI,PTS,PV2,PVB,PVC,PVE,PVG,PVI,PVL,PVR,PVS,PVV,PVX,PXA,QHD,QNC,QST,QTC,RCL,S55,S74,S99,SAF,SAP,SCI,SCJ,SCL,SCR,SD2,SD4,SD5,SD6,SD7,SD9,SDA,SDC,SDD,SDE,SDG,SDH,SDN,SDP,SDT,SDU,SDY,SEB,SED,SFN,SGC,SGD,SGH,SGO,SHA,SHB,SHE,SHN,SHS,SIC,SJ1,SJC,SJE,SLS,SMN,SMT,SPI,SPP,SRA,SSM,STC,STP,SVN,TA9,TAG,TAR,TBX,TC6,TCS,TDN,TDT,TET,TFC,TH1,THB,THS,THT,THV,TIG,TJC,TKC,TKU,TLC,TMB,TMC,TMX,TNG,TPH,TPP,TSB,TST,TTB,TTC,TTH,TTL,TTT,TTZ,TV2,TV3,TV4,TVC,TVD,TXM,UNI,V12,V21,VAT,VBC,VBH,VC1,VC2,VC3,VC6,VC7,VC9,VCC,VCG,VCM,VCR,VCS,VDL,VDS,VE1,VE2,VE3,VE4,VE8,VE9,VFR,VGC,VGP,VGS,VHE,VHL,VIE,VIG,VIT,VIX,VKC,VLA,VMC,VMI,VMS,VNC,VNF,VNR,VNT,VSA,VSM,VTC,VTH,VTJ,VTL,VTS,VTV,VXB,WCS,WSS,X20,XMC,AAA,AAM,ABT,ACC,ACL,ADS,AGF,AGM,AGR,AMD,ANV,APC,APG,ASM,ASP,AST,ATA,ATG,BBC,BCE,BCG,BCI,BFC,BGM,BHN,BHS,BIC,BID,BMC,BMI,BMP,BRC,BSI,BT6,BTP,BTT,BVH,BWE,C32,C47,CAV,CCI,CCL,CDC,CDO,CEE,CHP,CIG,CII,CLC,CLG,CLL,CLW,CMG,CMT,CMV,CMX,CNG,COM,CRC,CRE,CSM,CSV,CTD,CTF,CTG,CTI,CTS,CVT,CYC,D2D,DAG,DAH,DAT,DBD,DCL,DCM,DGW,DHA,DHC,DHG,DHM,DIC,DIG,DLG,DMC,DPG,DPM,DPR,DQC,DRC,DRH,DRL,DSN,DTA,DTL,DTT,DVP,DXG,DXV,E1VFVN30,E1VFVN31,E1VFVN32,EIB,ELC,EMC,EVE,EVG,FCM,FCN,FDC,FIR,FIT,FLC,FMC,FPT,FRT,FTM,FTS,FUCTVGF1,FUCTVGF2,FUCVREIT,FUESSV50,GAS,GDT,GEX,GIL,GMC,GMD,GSP,GTA,GTN,GTT,HAG,HAH,HAI,HAP,HAR,HAS,HAX,HBC,HCD,HCM,HDB,HDC,HDG,HHS,HID,HII,HLG,HMC,HN0-INDEX,HNG,HOT,HPG,HPX,HQC,HRC,HSG,HSL,HT1,HTI,HTL,HTN,HTT,HTV,HU1,HU3,HUB,HVG,HVH,HVX,IBC,ICF,IDI,IJC,IMP,ITA,ITC,ITD,JVC,KAC,KBC,KDC,KDH,KHA,KHP,KMR,KPF,KSA,KSB,KSH,KSS,KTB,L10,LAF,LBM,LCG,LCM,LDG,LEC,LGC,LGL,LHG,LIX,LM8,LMH,LSS,MBB,MCG,MCP,MDG,MHC,MSH,MSN,MWG,NAF,NAV,NBB,NCT,NHS,NKG,NLG,NNC,NSC,NT2,NTL,NVL,NVT,OGC,OPC,PAC,PAN,PC1,PDN,PDR,PET,PGC,PGD,PGI,PHC,PHR,PIT,PJT,PLP,PLX,PME,PMG,PNC,PNJ,POM,POW,PPC,PPI,PTB,PTC,PTK,PTL,PVD,PVT,PXI,PXL,PXS,PXT,QBS,QCG,RAL,RDP,REE,RIC,ROS,S4A,SAB,SAM,SAV,SBA,SBT,SBV,SC5,SCD,SCR,SCS,SEC,SFC,SFG,SFI,SGN,SGR,SGT,SHA,SHI,SHP,SII,SJD,SJF,SJS,SKG,SMA,SMB,SMC,SPM,SRC,SRF,SSC,SSI,ST8,STB,STG,STK,STT,SVC,SVI,SVT,SZC,SZL,TAC,TBC,TCB,TCD,TCH,TCL,TCM,TCO,TCR,TCT,TDC,TDG,TDH,TDM,TDW,TEG,TGG,THG,THI,TIC,TIE,TIP,TIX,TLD,TLG,TLH,TMP,TMS,TMT,TNA,TNC,TNI,TNT,TPB,TPC,TRA,TRC,TS4,TSC,TTB,TTE,TTF,TTP,TV1,TVB,TVS,TVT,TYA,UDC,UIC,VAF,VCB,VCF,VCI,VDP,VDS,VFG,VHC,VHG,VHM,VIC,VID,VIP,VIS,VJC,VLF,VMD,VNA,VNALL-INDEX,VND,VNE,VNG,VNH,VNL,VNM,VNS,VNX-ALL,VNXALL,VOS,VPB,VPD,VPG,VPH,VPI,VPK,VPS,VRC,VRE,VSC,VSH,VSI,VTB,VTF,VTO,YBM,YEG,A32,ABC,ABI,ABR,AC4,ACE,ACS,ACV,ADP,AFC,AFX,AG1,AGP,AGX,AMP,AMS,ANT,APF,ART,ASD,ATA,ATB,AVC,AVF,B82,BAB,BAL,BAM,BBM,BBT,BCM,BCP,BDC,BDF,BDG,BDT,BDW,BEL,BGW,BHA,BHC,BHK,BHP,BHT,BHV,BLI,BLN,BLT,BMD,BMF,BMG,BMJ,BMN,BMS,BMV,BOT,BQB,BRR,BRS,BSA,BSD,BSG,BSH,BSL,BSP,BSQ,BSR,BT1,BT6,BTB,BTC,BTD,BTG,BTH,BTN,BTR,BTU,BTV,BTW,BUD,BVG,BVN,BWA,BWS,BXD,C12,C21,C22,C4G,C71,CAD,CAT,CBI,CBS,CC1,CC4,CCH,CCM,CCP,CCR,CCV,CDG,CDH,CDO,CDP,CDR,CE1,CEC,CEG,CEN,CFC,CGP,CGV,CH5,CHC,CHP,CHS,CI5,CID,CIP,CKA,CKD,CKH,CLS,CLX,CMF,CMN,CMW,CNC,CNH,CNN,CNT,CPI,CQT,CSI,CT3,CTN,CTR,CTW,CVC,CXH,CYC,CZC,D26,DAC,DAP,DAR,DAS,DBD,DBH,DBM,DC1,DCD,DCF,DCG,DCH,DCI,DCT,DDH,DDM,DDN,DDV,DFC,DGT,DHB,DHD,DHN,DLC,DLD,DLT,DLV,DNA,DND,DNE,DNF,DNH,DNL,DNN,DNR,DNS,DNT,DNW,DOC,DOP,DP1,DP2,DPH,DPP,DRI,DSC,DSG,DSP,DSS,DSV,DT4,DTC,DTG,DTI,DTK,DTN,DTV,DVC,DVH,DVN,DVW,DXL,EAD,EFI,EIC,EIN,EME,EMG,EMS,EPH,EVF,EVS,FBA,FBC,FCC,FCS,FDG,FGL,FHN,FHS,FIC,FOC,FOX,FRC,FRM,FSC,FSO,FT1,FTI,G20,G36,GCB,GDW,GEG,GER,GGG,GGS,GHC,GLC,GLW,GND,GSM,GTC,GTD,GTH,GTS,GTT,GVR,GVT,H11,HAB,HAC,HAF,HAM,HAN,HAV,HBD,HBH,HBI,HBW,HC3,HCI,HCS,HD2,HD8,HDM,HDO,HDP,HDW,HEC,HEJ,HEM,HEP,HES,HFB,HFC,HFT,HFX,HGW,HHA,HHN,HHR,HHV,HIG,HIZ,HJC,HKP,HLA,HLB,HLE,HLR,HLS,HMG,HMS,HNA,HNB,HND,HNF,HNI,HNP,HNR,HNT,HPB,HPD,HPH,HPI,HPL,HPP,HPT,HPU,HPW,HRB,HRG,HRT,HSA,HSI,HSM,HTE,HTG,HTK,HTM,HTR,HU4,HU6,HUG,HVC,HVN,HWS,I40,ICC,ICI,ICN,IDC,IDN,IFC,IFS,IHK,IKH,ILA,ILC,ILS,IME,IMT,IN4,IPA,IRC,ISG,ISH,IST,ITS,JOS,JSC,KBE,KCB,KCE,KDF,KGM,KGU,KHA,KHD,KHL,KHW,KIP,KLB,KOS,KSC,KSE,KSS,KSV,KTB,KTC,KTL,KTU,L12,L44,L45,L63,LAI,LAW,LBC,LCC,LG9,LIC,LKW,LLM,LM3,LMC,LMI,LPB,LTG,M10,MCH,MCI,MCT,MDF,MEF,MGC,MGG,MH3,MIC,MIG,MJC,MKP,MKT,MLN,MLS,MMC,MNB,MND,MPC,MQB,MQN,MRF,MSR,MTA,MTC,MTG,MTH,MTL,MTM,MTP,MTV,MVB,MVC,MVN,MVY,NAC,NAS,NAW,NBE,NBR,NBS,NBT,NCP,NCS,ND2,NDC,NDP,NDT,NED,NHH,NHN,NHT,NHV,NLS,NMK,NNG,NNT,NOS,NPH,NPS,NQB,NQN,NQT,NS2,NS3,NSG,NSP,NTB,NTC,NTR,NTT,NTW,NUE,NVP,NWT,OIL,ONW,PBT,PCC,PCF,PCM,PDT,PDV,PEC,PEQ,PFL,PFV,PGV,PHH,PIA,PID,PIS,PIV,PJS,PKR,PLA,PMJ,PMT,PND,PNG,PNT,POB,POS,POV,PPG,PPH,PRO,PRT,PSB,PSG,PSL,PSN,PSP,PTE,PTG,PTH,PTK,PTM,PTO,PTP,PTT,PTX,PVA,PVH,PVM,PVO,PVP,PVR,PVY,PWS,PX1,PXA,PXL,PXM,QBR,QCC,QHW,QLD,QLT,QNS,QNU,QPH,QSP,QTP,RAT,RBC,RCC,RCD,REM,RGC,RHN,RLC,RTB,RTH,RTS,S12,S27,S33,S72,S96,SAC,SAL,SAP,SAS,SB1,SBD,SBH,SBL,SBM,SBS,SCC,SCH,SCI,SCO,SD1,SD3,SD7,SD8,SDB,SDF,SDH,SDI,SDJ,SDK,SDP,SDV,SDX,SDY,SEA,SEP,SFT,SGP,SGR,SGS,SHC,SHG,SHV,SHX,SID,SIV,SJG,SJM,SKH,SKN,SKV,SLC,SMB,SNC,SNZ,SON,SP2,SPA,SPB,SPC,SPD,SPH,SPV,SQC,SRB,SRT,SSF,SSG,SSN,SSU,STL,STS,STT,STU,STV,STW,SVG,SVH,SWC,SZE,TA3,TA6,TAG,TAP,TAW,TB8,TBD,TBT,TCI,TCK,TCW,TDB,TDM,TDP,TDS,TEL,TGP,TH1,THR,THW,TID,TIS,TL4,TLI,TLP,TLT,TMG,TMW,TNB,TND,TNM,TNP,TNS,TNW,TNY,TOP,TOT,TPS,TQN,TRS,TRT,TSG,TSJ,TTD,TTG,TTJ,TTN,TTP,TTR,TTS,TTV,TUG,TV1,TVA,TVG,TVH,TVM,TVN,TVP,TVU,TVW,TW3,UDJ,UEM,UPC,UPH,USC,V11,V15,VAV,VBG,VBH,VC5,VCA,VCE,VCP,VCT,VCW,VCX,VDM,VDN,VDT,VEA,VEC,VEE,VEF,VES,VET,VFC,VFR,VGG,VGI,VGL,VGR,VGT,VGV,VHD,VHF,VHH,VIA,VIB,VIF,VIH,VIM,VIN,VIR,VIW,VKD,VKP,VLB,VLC,VLF,VLG,VLP,VLW,VMA,VMG,VNA,VNB,VNH,VNI,VNN,VNP,VNX,VNY,VOC,VPA,VPC,VPR,VQC,VRG,VSE,VSF,VSG,VSN,VSP,VST,VT1,VT8,VTA,VTE,VTG,VTI,VTK,VTP,VTX,VVN,VWS,WSB,WTC,WTN,X18,X26,X77,XDH,XHC,XLV,XMD,XPH,YBC,YRC,YTC") 
    } 
    if (action === "d") {
      const s = data.indexOf(":")
      const type = data.substring(0, s)
      const encrypted_data = data.slice(s + 1)
      const d = encrypted_data.split("").map((e, t) => String.fromCharCode(e.charCodeAt(0) + t % 5)).join("").split("|");
      writeToScreen('<span style="color: green;">DATA: ' + d +'</span>');
    }
  }
  function onError(evt)
  {
    writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
  }
  function doSend(message)
  {
    writeToScreen("SENT: " + message);
    websocket.send(message);
  }
  function writeToScreen(message)
  {
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
    
    // const fs = require('fs');
    // fs.appendFileSync('/Users/binhna/projects/dev/price-feed/example.txt', message);
  }
  window.addEventListener("load", init, false);
  </script>
  <h2>WebSocket Test</h2>
  <div id="output"></div>